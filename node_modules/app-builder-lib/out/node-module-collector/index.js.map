{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/node-module-collector/index.ts"],"names":[],"mappings":";;;AAOA,oEAeC;AAED,wCAGC;AAED,oDAwBC;AArDD,uEAAmE;AACnE,yEAAqE;AACrE,yEAAqE;AACrE,qDAA2I;AAoDlI,mFApD2D,mBAAE,OAoD3D;AAAE,yGApD2D,yCAAwB,OAoD3D;AAhD9B,KAAK,UAAU,4BAA4B,CAAC,EAAM,EAAE,OAAe,EAAE,cAAsB;IAChG,QAAQ,EAAE,EAAE,CAAC;QACX,KAAK,mBAAE,CAAC,IAAI;YACV,IAAI,MAAM,mDAAwB,CAAC,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC;gBACjE,OAAO,IAAI,iDAAuB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAA;YAC7D,CAAC;YACD,OAAO,IAAI,mDAAwB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAA;QAC9D,KAAK,mBAAE,CAAC,GAAG,CAAC;QACZ,KAAK,mBAAE,CAAC,GAAG;YACT,OAAO,IAAI,iDAAuB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAA;QAC7D,KAAK,mBAAE,CAAC,IAAI;YACV,OAAO,IAAI,mDAAwB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAA;QAC9D;YACE,OAAO,IAAI,iDAAuB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAA;IAC/D,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,cAAc,CAAC,EAAM,EAAE,OAAe,EAAE,cAAsB;IAClF,MAAM,SAAS,GAAG,MAAM,4BAA4B,CAAC,EAAE,EAAE,OAAO,EAAE,cAAc,CAAC,CAAA;IACjF,OAAO,SAAS,CAAC,cAAc,EAAE,CAAA;AACnC,CAAC;AAED,SAAgB,oBAAoB,CAAC,IAAc;IACjD,IAAI,EAAE,GAAc,IAAI,CAAA;IAExB,MAAM,kBAAkB,GAAG,CAAC,EAAM,EAAE,EAAE;QACpC,IAAI,EAAE,KAAK,mBAAE,CAAC,IAAI,EAAE,CAAC;YACnB,OAAO,IAAA,gCAAe,GAAE,CAAA;QAC1B,CAAC;QACD,OAAO,EAAE,CAAA;IACX,CAAC,CAAA;IAED,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE,CAAC;QACvB,EAAE,GAAG,IAAA,+CAA8B,EAAC,GAAG,CAAC,CAAA;QACxC,IAAI,EAAE,EAAE,CAAC;YACP,OAAO,kBAAkB,CAAC,EAAE,CAAC,CAAA;QAC/B,CAAC;IACH,CAAC;IAED,EAAE,GAAG,IAAA,0CAAyB,GAAE,CAAA;IAChC,IAAI,EAAE,EAAE,CAAC;QACP,OAAO,kBAAkB,CAAC,EAAE,CAAC,CAAA;IAC/B,CAAC;IAED,iBAAiB;IACjB,OAAO,mBAAE,CAAC,GAAG,CAAA;AACf,CAAC","sourcesContent":["import { NpmNodeModulesCollector } from \"./npmNodeModulesCollector\"\nimport { PnpmNodeModulesCollector } from \"./pnpmNodeModulesCollector\"\nimport { YarnNodeModulesCollector } from \"./yarnNodeModulesCollector\"\nimport { detectPackageManagerByLockfile, detectPackageManagerByEnv, PM, getPackageManagerCommand, detectYarnBerry } from \"./packageManager\"\nimport { NodeModuleInfo } from \"./types\"\nimport { TmpDir } from \"temp-file\"\n\nexport async function getCollectorByPackageManager(pm: PM, rootDir: string, tempDirManager: TmpDir) {\n  switch (pm) {\n    case PM.PNPM:\n      if (await PnpmNodeModulesCollector.isPnpmProjectHoisted(rootDir)) {\n        return new NpmNodeModulesCollector(rootDir, tempDirManager)\n      }\n      return new PnpmNodeModulesCollector(rootDir, tempDirManager)\n    case PM.NPM:\n    case PM.BUN:\n      return new NpmNodeModulesCollector(rootDir, tempDirManager)\n    case PM.YARN:\n      return new YarnNodeModulesCollector(rootDir, tempDirManager)\n    default:\n      return new NpmNodeModulesCollector(rootDir, tempDirManager)\n  }\n}\n\nexport async function getNodeModules(pm: PM, rootDir: string, tempDirManager: TmpDir): Promise<NodeModuleInfo[]> {\n  const collector = await getCollectorByPackageManager(pm, rootDir, tempDirManager)\n  return collector.getNodeModules()\n}\n\nexport function detectPackageManager(dirs: string[]): PM {\n  let pm: PM | null = null\n\n  const resolveYarnVersion = (pm: PM) => {\n    if (pm === PM.YARN) {\n      return detectYarnBerry()\n    }\n    return pm\n  }\n\n  for (const dir of dirs) {\n    pm = detectPackageManagerByLockfile(dir)\n    if (pm) {\n      return resolveYarnVersion(pm)\n    }\n  }\n\n  pm = detectPackageManagerByEnv()\n  if (pm) {\n    return resolveYarnVersion(pm)\n  }\n\n  // Default to npm\n  return PM.NPM\n}\n\nexport { PM, getPackageManagerCommand }\n"]}