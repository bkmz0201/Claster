"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MakerFlatpak = exports.flatpakArch = void 0;
const node_path_1 = __importDefault(require("node:path"));
const maker_base_1 = require("@electron-forge/maker-base");
const fs_extra_1 = __importDefault(require("fs-extra"));
function flatpakArch(nodeArch) {
    switch (nodeArch) {
        case 'ia32':
            return 'i386';
        case 'x64':
            return 'x86_64';
        case 'armv7l':
            return 'arm';
        case 'arm64':
            return 'aarch64';
        // arm => arm
        default:
            return nodeArch;
    }
}
exports.flatpakArch = flatpakArch;
class MakerFlatpak extends maker_base_1.MakerBase {
    constructor() {
        super(...arguments);
        this.name = 'flatpak';
        this.defaultPlatforms = ['linux'];
        this.requiredExternalBinaries = ['flatpak-builder', 'eu-strip'];
    }
    isSupportedOnCurrentPlatform() {
        return this.isInstalled('@malept/electron-installer-flatpak');
    }
    async make({ dir, makeDir, targetArch }) {
        // eslint-disable-next-line n/no-missing-require
        const installer = require('@malept/electron-installer-flatpak');
        const arch = flatpakArch(targetArch);
        const outDir = node_path_1.default.resolve(makeDir, 'flatpak', arch);
        await this.ensureDirectory(outDir);
        const flatpakConfig = {
            ...this.config,
            arch,
            src: dir,
            dest: outDir,
        };
        await installer(flatpakConfig);
        return (await fs_extra_1.default.readdir(outDir))
            .filter((basename) => basename.endsWith('.flatpak'))
            .map((basename) => node_path_1.default.join(outDir, basename));
    }
}
exports.default = MakerFlatpak;
exports.MakerFlatpak = MakerFlatpak;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFrZXJGbGF0cGFrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL01ha2VyRmxhdHBhay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwREFBNkI7QUFFN0IsMkRBQXFFO0FBRXJFLHdEQUEwQjtBQUkxQixTQUFnQixXQUFXLENBQUMsUUFBbUI7SUFDN0MsUUFBUSxRQUFRLEVBQUUsQ0FBQztRQUNqQixLQUFLLE1BQU07WUFDVCxPQUFPLE1BQU0sQ0FBQztRQUNoQixLQUFLLEtBQUs7WUFDUixPQUFPLFFBQVEsQ0FBQztRQUNsQixLQUFLLFFBQVE7WUFDWCxPQUFPLEtBQUssQ0FBQztRQUNmLEtBQUssT0FBTztZQUNWLE9BQU8sU0FBUyxDQUFDO1FBQ25CLGFBQWE7UUFDYjtZQUNFLE9BQU8sUUFBUSxDQUFDO0lBQ3BCLENBQUM7QUFDSCxDQUFDO0FBZEQsa0NBY0M7QUFFRCxNQUFxQixZQUFhLFNBQVEsc0JBQTZCO0lBQXZFOztRQUNFLFNBQUksR0FBRyxTQUFTLENBQUM7UUFFakIscUJBQWdCLEdBQW9CLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFOUMsNkJBQXdCLEdBQWEsQ0FBQyxpQkFBaUIsRUFBRSxVQUFVLENBQUMsQ0FBQztJQTJCdkUsQ0FBQztJQXpCQyw0QkFBNEI7UUFDMUIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBZ0I7UUFDbkQsZ0RBQWdEO1FBQ2hELE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1FBRWhFLE1BQU0sSUFBSSxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyQyxNQUFNLE1BQU0sR0FBRyxtQkFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRXRELE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuQyxNQUFNLGFBQWEsR0FBRztZQUNwQixHQUFHLElBQUksQ0FBQyxNQUFNO1lBQ2QsSUFBSTtZQUNKLEdBQUcsRUFBRSxHQUFHO1lBQ1IsSUFBSSxFQUFFLE1BQU07U0FDYixDQUFDO1FBRUYsTUFBTSxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFL0IsT0FBTyxDQUFDLE1BQU0sa0JBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDOUIsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ25ELEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsbUJBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQztDQUNGO0FBaENELCtCQWdDQztBQUVRLG9DQUFZIn0=