{"version":3,"file":"runtime.js","sourceRoot":"","sources":["../src/runtime.ts"],"names":[],"mappings":"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","sourcesContent":["import type { FPDF_Config, PDFiumModule } from '@toeverything/pdfium';\nimport type {\n  ErrorCode,\n  BitmapFormat,\n  FileIdentifier,\n  PageMode,\n  Rotation,\n} from '@toeverything/pdf-viewer-types';\n\nexport const DefaultConfig: FPDF_Config = {\n  version: 3,\n  m_pIsolate: null,\n  m_pPlatform: null,\n  m_pUserFontPaths: null,\n  m_v8EmbedderSlot: 0,\n};\n\n/**\n * PDFium runtime.\n */\nexport class Runtime {\n  constructor(public engine: PDFiumModule) {\n    this.init(DefaultConfig);\n  }\n\n  get wasm() {\n    return this.engine.wasmExports;\n  }\n\n  get HEAPU8() {\n    return this.engine.HEAPU8;\n  }\n\n  malloc(size: number) {\n    return this.wasm.malloc(size);\n  }\n\n  free(ptr: number) {\n    this.wasm.free(ptr);\n  }\n\n  stringToUTF8(str: string, strPtr: number, maxBytesToRead?: number) {\n    this.engine.stringToUTF8(str, strPtr, maxBytesToRead);\n  }\n\n  stringToNewUTF8(str: string) {\n    return this.engine.stringToNewUTF8(str);\n  }\n\n  UTF8ToString(ptr: number, maxBytesToRead?: number) {\n    return this.engine.UTF8ToString(ptr, maxBytesToRead);\n  }\n\n  UTF16ToString(ptr: number, maxBytesToRead?: number) {\n    return this.engine.UTF16ToString(ptr, maxBytesToRead);\n  }\n\n  getValue(ptr: number, type: Emscripten.CType) {\n    return this.engine.getValue(ptr, type);\n  }\n\n  setValue(ptr: number, value: any, type: Emscripten.CType, noSafe?: boolean) {\n    return this.engine.setValue(ptr, value, type, noSafe);\n  }\n\n  /**\n   * Copys bytes to WASM.\n   */\n  copyBytesTo(bytes: Uint8Array) {\n    const size = bytes.length;\n    const bytesPtr = this.malloc(size);\n    this.HEAPU8.set(bytes, bytesPtr);\n    return bytesPtr;\n  }\n\n  /**\n   * Initialize the PDFium library and allocate global resources for it.\n   */\n  init = this.wasm.FPDF_InitLibraryWithConfig;\n  deinit = this.wasm.FPDF_DestroyLibrary;\n\n  /**\n   * Gets last error code when a function fails.\n   */\n  lastErrorCode = this.wasm.FPDF_GetLastError<ErrorCode>;\n\n  version = this.wasm.FPDF_GetFileVersion;\n\n  fileIdentifier = this.wasm.FPDF_GetFileIdentifier<FileIdentifier>;\n\n  metaText = this.wasm.FPDF_GetMetaText;\n\n  openDocument = this.wasm.FPDF_LoadMemDocument64;\n\n  pageMode = this.wasm.FPDFDoc_GetPageMode<PageMode>;\n\n  closeDocument(ptr: number) {\n    this.wasm.FPDF_CloseDocument(ptr);\n    this.free(ptr);\n  }\n\n  pageCount = this.wasm.FPDF_GetPageCount;\n\n  loadPage = this.wasm.FPDF_LoadPage;\n  closePage = this.wasm.FPDF_ClosePage;\n  pageLabel = this.wasm.FPDF_GetPageLabel;\n  pageWidth = this.wasm.FPDF_GetPageWidthF;\n  pageHeight = this.wasm.FPDF_GetPageHeightF;\n  pageSize = this.wasm.FPDF_GetPageSizeByIndexF;\n  pageRotation = this.wasm.FPDFPage_GetRotation<Rotation>;\n  pageTransparency = this.wasm.FPDFPage_HasTransparency;\n  renderPageBitmap = this.wasm.FPDF_RenderPageBitmap;\n\n  pointFromDeviceToPage = this.wasm.FPDF_DeviceToPage;\n  pointFromPageToDevice = this.wasm.FPDF_PageToDevice;\n\n  createBitmap = this.wasm.FPDFBitmap_Create;\n  createBitmapWith = this.wasm.FPDFBitmap_CreateEx<BitmapFormat>;\n  fillBitmap = this.wasm.FPDFBitmap_FillRect;\n  closeBitmap = this.wasm.FPDFBitmap_Destroy;\n\n  bitmapWidth = this.wasm.FPDFBitmap_GetWidth;\n  bitmapHeight = this.wasm.FPDFBitmap_GetHeight;\n  bitmapStride = this.wasm.FPDFBitmap_GetStride;\n  bitmapBuffer = this.wasm.FPDFBitmap_GetBuffer;\n}\n"]}