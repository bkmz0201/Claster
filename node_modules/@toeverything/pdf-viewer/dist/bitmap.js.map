{"version":3,"file":"bitmap.js","sourceRoot":"","sources":["../src/bitmap.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,YAAY,EAAE,MAAM,gCAAgC,CAAC;AAG9D,MAAM,OAAO,MAAM;aACV,WAAM,GAAG,YAAY,CAAC,IAAI,CAAC;IAElC,YACS,OAAgB,EACf,GAAW,EACZ,SAAS,MAAM,CAAC,MAAM;QAFtB,YAAO,GAAP,OAAO,CAAS;QACf,QAAG,GAAH,GAAG,CAAQ;QACZ,WAAM,GAAN,MAAM,CAAgB;IAC5B,CAAC;IAEJ,IAAI,OAAO;QACT,OAAO,IAAI,CAAC,GAAG,CAAC;IAClB,CAAC;IAED,KAAK;QACH,IAAI,CAAC,IAAI,CAAC,GAAG;YAAE,OAAO;QACtB,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC5B,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;IACf,CAAC;IAED,IAAI,CACF,IAAY,EACZ,GAAW,EACX,KAAa,EACb,MAAc,EACd,KAAK,GAAG,UAAU,CAAC,SAAS;;QAE5B,OAAO,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;IAC5E,CAAC;IAED,YAAY;QACV,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACnD,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACnD,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACtD,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CACzC,SAAS,EACT,SAAS,GAAG,MAAM,GAAG,MAAM,CAC5B,CAAC;QACF,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC7B,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,CAAC,MAAM,CAAC,OAAO,CAAC;QACd,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC","sourcesContent":["import { BitmapFormat } from '@toeverything/pdf-viewer-types';\nimport type { Runtime } from './runtime.js';\n\nexport class Bitmap {\n  static format = BitmapFormat.BGRA;\n\n  constructor(\n    public runtime: Runtime,\n    private ptr: number,\n    public format = Bitmap.format\n  ) {}\n\n  get pointer() {\n    return this.ptr;\n  }\n\n  close() {\n    if (!this.ptr) return;\n    this.runtime.closeBitmap(this.ptr);\n    this.runtime.free(this.ptr);\n    this.ptr = 0;\n  }\n\n  fill(\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    color = 0xffffffff // 32 bit\n  ) {\n    return this.runtime.fillBitmap(this.ptr, left, top, width, height, color);\n  }\n\n  toUint8Array() {\n    const stride = this.runtime.bitmapStride(this.ptr);\n    const height = this.runtime.bitmapHeight(this.ptr);\n    const bufferPtr = this.runtime.bitmapBuffer(this.ptr);\n    const buffer = this.runtime.HEAPU8.subarray(\n      bufferPtr,\n      bufferPtr + stride * height\n    );\n    this.runtime.free(bufferPtr);\n    return buffer;\n  }\n\n  [Symbol.dispose]() {\n    this.close();\n  }\n}\n"]}